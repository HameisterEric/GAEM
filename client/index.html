<title> Test </title>
<div id ="signDiv">
	Username: <input id = "signDiv-username" type = "text"></input><br>
	Password: <input id = "signDiv-password" type = "password"></input>
	<button id = "signDiv-signIn">Sign In</button>
	<button id = "signDiv-signUp">Sign Up</button>
</div>

<div id ="gameDiv" style = "display:none;">

	<canvas id = "ctx" width = "500" height="500"> </canvas>
	<div id = "chat-text" style = "width 500px;height:100px;overflow-y:scroll"></div>

	<form id = "chat-form">
		<input id = "chat-input" type = "text" style ="width:500px"> </input>
	</form>
	
</div>
<script src = "https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
	var socket = io();
	var signDiv = document.getElementById('signDiv');
	var signDivUsername = document.getElementById('signDiv-username');
	var signDivSignIn = document.getElementById('signDiv-signIn');
	var signDivSignUp = document.getElementById('signDiv-signUp');
	var signDivPassword = document.getElementById('signDiv-password');
	signDivSignIn.onclick = function(){
		socket.emit('signIn',{username:signDivUsername.value,password:signDivPassword.value});
	}
	signDivSignUp.onclick = function(){
		socket.emit('signUp',{username:signDivUsername.value,password:signDivPassword.value});
	}
	socket.on('signInResponse',function(data){
		if(data.success){
			signDiv.style.display = 'none';
			gameDiv.style.display = 'inline-block';
			var hero = new Image()
			//hero.src = "client/img/Character_Knight";
			//hero.addEventListener('load', function(){
				socket.emit('loaded',{success:true});
			//});
		}
		else
			alert("Sign in failed");
	});
	socket.on('signUpResponse',function(data){
		if(data.success){
			alert("Sign up successful");
		}
		else
			alert("Sign up failed");
	});
	
	var ctx = document.getElementById("ctx").getContext("2d");
	var chatText = document.getElementById('chat-text');
	var chatInput = document.getElementById('chat-input');
	var chatForm = document.getElementById('chat-form');
	ctx.font = "30px Ariel";
	var positions;
	socket.on('newPosition',function(data){
		positions = data;
	});
	
	socket.on('addToChat', function(data){
		chatText.innerHTML += '<div>' + data + '</div>';
	});
		
	chatForm.onsubmit = function(e){
		e.preventDefault();
		socket.emit('sendText',chatInput.value);
		chatInput.value = '';
	}
	
	var Player = function(pack){
		var self = {};
		self.id = pack.id;
		self.x = pack.x;
		self.y = pack.y;
		Player.list[self.id] = self;
		return self;
	}
	Player.list = {};
	var Mob = function(pack){
		var self = {}
		self.number = pack.number;
		self.x = pack.x;
		self.y = pack.y;
		Mob.list[self.number] = self;
		return self;
	}
	Mob.list = {};
	socket.on('init', function(data){
		for(var i in data.players){
			new Player(data.players[i]);
		}
		for(var i in data.mobs){
			new Mob(data.mobs[i]);
		}
	});
	socket.on('update',function(data){
		for(var i in data.players){
			Player.list[i].x = data.players[i].x;
			Player.list[i].y = data.players[i].y;
 		}
		for(var i in data.mobs){
			Mob.list[data.mobs[i].number].x = data.mobs[i].x;
			Mob.list[data.mobs[i].number].y = data.mobs[i].y;
 		}
	});
	socket.on('remove',function(data){
		for(var i in data.players){
			delete Player.list[data.players[i].number];
 		}
		for(var i in data.mobs){
			delete Mob.list[data.mobs[i].number];
 		}
	});
	setInterval(function(){
		ctx.clearRect(0,0,500,500);
		for(var i in Player.list){
			ctx.fillText('P',Player.list[i].x, Player.list[i].y);
		}
		for(var i in Mob.list){
			ctx.fillRect(Mob.list[i].x,Mob.list[i].y,10,10);
		}
	},1000/60);
	</script>